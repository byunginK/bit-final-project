<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
  <head th:replace="fragments/config :: configFragment"></head>
<body>

<input type="hidden" id="articleSeq" name="articleSeq" th:value="${articleSeq}">
<input type="hidden" id="userSeq" name="userSeq" th:value="${userSeq}">
<input type="hidden" id="writerSeq" name="writerSeq" th:value="${writerInfo.writerSeq}">


<h3>책표지(임시 업로드 인성 문제잇음)</h3>

<br><br>

<img src="/static/profile/profiledefault.png">

<br><br>

<div style="float:left;">작가이름 : </div>
<input style="float:left;" type="text" id="categorys" name="categorys" readonly="readonly" th:value="${writerInfo.writerName}">


<button th:if="${followChk} == '0'" style="float:left; margin-right: 10px" name="follows" id="follow">follower</button>

<button th:if="${followChk} == '1'" style="float:left; margin-right: 10px" id="unfollow">Unfollower</button>


<button style="float:left;" id="like">like</button>


<br><br>

<div style="float:left;">카테고리 : </div>
<input type="text" id="categorys" name="categorys" readonly="readonly" th:value="${list.categorys}">

<br><br>

<div style="float:left;">제목 : </div>
<input type="text" id="title" name="title" readonly="readonly" th:value="${list.title}">

<br><br>

<div style="float:left;">조회수 : </div>
<input type="text" id="viewCount" name="viewCount" readonly="readonly" th:value="${list.viewCount}">

<br><br>

<div style="float:left;">작성일 : </div>
<input type="text" id="uploadDate" name="uploadDate" readonly="readonly" th:value="${list.uploadDate}">

<br><br>

<h3>내용(못불러옴 CLOB이라서 아직)</h3>
<textarea id="cont" name="cont" rows="20" cols="50" readonly="readonly" th:value="${list.cont}"></textarea>

<br><br>

<h3>유저 시퀀스 같은지 확인용</h3>

<br><br>

<div th:text="${userSeq}"></div>
<div th:text="${writerInfo.userSeq}"></div>

<br><br>

<div th:if="${userSeq} == ${writerInfo.userSeq}">
	<a th:href="@{'/article/update?articleSeq=' + ${articleSeq}}">
	<button id="updatebtn" style="float:left; margin-right: 10px">수정</button>
	</a>
	
	<button id="deletebtn">삭제</button>
	
</div>

<script type="application/javascript" th:inline="javascript">
  $(function () {
    var csrfToken = /*[[${_csrf.token}]]*/ null;
    var csrfHeader = /*[[${_csrf.headerName}]]*/ null;
    $(document).ajaxSend(function (e, xhr, options) {
      xhr.setRequestHeader(csrfHeader, csrfToken);
    });
  });
</script>

<script type="text/javascript">
$(document).ready(function(){
$("#followNext").hide();
$("#unfollowNext").hide();

let userSeq = $("#userSeq").val();
let writerSeq = $("#writerSeq").val();


$("#follow").click(function() {
	$.ajax({
		url:"/article/follow",
		type:"post",
		contentType: "application/x-www-form-urlencoded; charset=UTF-8",
		data:{ userSeq:$("#userSeq").val() , follower:$("#writerSeq").val()},
		success:function( msg ){
			if(msg == 'ok'){
				swal({
				    title: "^.^",
				    text: "작가님을 팔로우 하였습니다.",
				    icon: "success"
				}).then(function() {
					history.go(0);
				});
			}
		},
		error:function(){
			alert("error");
		}			
	});
});

	$("#unfollow").click(function() {
		$.ajax({
			url:"/article/unfollow",
			type:"post",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
			data:{ userSeq:$("#userSeq").val() , follower:$("#writerSeq").val()},
			success:function( msg ){
				if(msg == 'ok'){
					swal({
					    title: "T.T",
					    text: "작가님을 언팔로우 하였습니다.",
					    icon: "warning"
					}).then(function() {
						history.go(0);
					});
				}
			},
			error:function(){
				alert("error");
			}			
		});
	});


	$("#deletebtn").click(function() {
	
			$.ajax({
				url:"/article/delete",
				type:"post",
				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				data:{ articleSeq:$("#articleSeq").val() , follower:$("#writerSeq").val()},
				success:function( msg ){
					if(msg == 'ok'){
						swal({
						    title: "good!",
						    text: "글 삭제가 완료되었습니다.",
						    type: "success"
						}).then(function() {
						    window.location = "/myPage";
						});
					}
				},
				error:function(){
					alert("error");
				}			
			});
	});
});
</script>


</body>
</html>