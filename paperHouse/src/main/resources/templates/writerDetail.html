<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
</head>
<body>

<input type="hidden" id="nickname" th:value="${nickname}"/>
<input type="hidden" id="userSeq" th:value="${userSeq}"/>
<input type="hidden" id="email" th:value="${email}"/>
<input type="hidden" id="writerSeq" th:value="${param.writerSeq}"/> 

<h1>작가 이미지</h1>


 <br>

<h1 th:text="${list.writerName}"></h1>
  <div>
  <button>좋아요</button>
  </div>
  
 
 <h3>작가 이력</h3>
 
  <br>
 <input type="text" th:value="${list.history}"> 
 
 <br><br>
 
 <h3>작가 소개</h3>
 <input type="text" th:value="${list.intro}"> 
 <br><br>
 
<table border="1">
<tr>
	<th>구독중인 사람</th><th>좋아요 개수</th><th>작가가 쓴 글</th>
</tr>
<tr>
	<td>select user_subcribe</td><td>select follow</td><td>select article</td>
</tr>
</table> 

<br><br>
 
 <h3>작가 pr</h3>
 <textarea rows="20" cols="40"></textarea>
 
 <h3>작가가쓴 글</h3>
 
 <h3>한 줄 리뷰</h3>

<br><br>

<button id="purchase">결제하기</button>


<!--결제 -->
<script type="text/javascript">

let id=$("#nickname").val();
let userSeq=$("#userSeq").val();
let writerSeq=$("#writerSeq").val();
let email=$("#email").val();

$("#purchase").click(function(){
	IMP.init('imp61961074');
	
	IMP.request_pay({
	    pg : 'imp61961074', // version 1.1.0부터 지원.
	    pay_method : 'card',
	    merchant_uid : 'merchant_' + new Date().getTime(),
	    name : '주문명:종이의집 작가구독',
	    amount : 9900, //판매 가격
	    buyer_email : email,
	    buyer_name : id,
	    buyer_tel : '010-1234-5678'
	}, function(rsp) {
	    if ( rsp.success ) {
	     
	        let data = {
	        	"userSeq":userSeq,
	        	"writerSeq":writerSeq,
	        	"approvalNumber":rsp.apply_num,
	        	"paymentMethod":rsp.pay_method,
	        	"paymentDetail":rsp.paid_amount
	        };
	        $.ajax({
	        	url:"pay",
	        	type:"post",
	        	contentType: "application/x-www-form-urlencoded; charset=UTF-8",
	        	datatye:'json',
	        	data:data,
	        	async:true,	
	    		success:function( resp ){
	    			alert( resp );
	    			
	    			$.ajax({
	    				url:"sub",
	    				type:"post",
	    				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
	    				datatype:'json',
	    				data:data,
	    				async:true,	
	    				success:function( resp ){
	    					alert( resp );
	    				},
	    				error:function(){
	    					alert('error');
	    				}
	    			});
	    		},
	    		error:function(){
	    			alert('error');
	    		}
	        });
	    } else {
	        var msg = '결제에 실패하였습니다.';
	        msg += '에러내용 : ' + rsp.error_msg;
	    }
	});
});
</script>

</body>
</html>